(function(t){function e(e){for(var n,o,r=e[0],l=e[1],c=e[2],h=0,d=[];h<r.length;h++)o=r[h],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&d.push(s[o][0]),s[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,r=1;r<i.length;r++){var l=i[r];0!==s[l]&&(n=!1)}n&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},s={app:0},a=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},1:function(t,e){},2:function(t,e){},"21e5":function(t,e,i){"use strict";var n=i("c53c"),s=i.n(n);s.a},3:function(t,e){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flex flex-wrap overflow-hidden"},[i("div",{staticClass:"w-full lg:w-3/5 overflow-hidden text-center p-3"},[i("div",{staticClass:"pb-4"},[i("GameScore",{attrs:{score:t.score,round:t.round}})],1),i("GameField",{attrs:{fieldSize:t.fieldSize,objects:t.objects}})],1),i("div",{staticClass:"w-full lg:w-2/5 overflow-hidden p-3"},[i("GameStats",{attrs:{agent:t.getMouse()}}),i("div",{staticClass:"p-10"},[i("GameSpeedSlider",{attrs:{game:this}})],1),i("TrainAgentButton",{attrs:{game:this,agent:t.getMouse()}})],1)])},a=[],o=(i("a4d3"),i("e01a"),i("d28b"),i("4de4"),i("7db0"),i("d81d"),i("45fc"),i("d3b7"),i("3ca3"),i("ddb0"),i("bf2d")),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"text-lg xl:text-2xl text-gray-600 font-medium text-center"},[i("span",{staticClass:"p-3"},[t._v("Game "+t._s(t.round))]),i("span",{staticClass:"p-3"},[t._v("Score "),i("transition",{attrs:{name:"pulse",mode:"out-in"}},[i("span",{key:t.score,staticClass:"inline-block",class:t.scoreCssClass},[t._v(t._s(t.score))])])],1)])},l=[],c={name:"GameScore",props:["score","round"],computed:{scoreCssClass:function(){return this.score>=0?"text-green-600":"text-red-600"}}},u=c,h=(i("fc60"),i("2877")),d=Object(h["a"])(u,r,l,!1,null,null,null),p=d.exports,f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"grid border-t border-l text-sm sm:text-2xl xl:text-4xl text-center"},t._l(t.getCells(),(function(e,n){return i("div",{key:n,staticClass:"border-r border-b w-6 h-6 sm:w-10 sm:h-10 xl:w-16 xl:h-16"},[t._v(t._s(e))])})),0)},m=[],g=(i("cb29"),{name:"GameField",props:["fieldSize","objects"],data:function(){return{cells:Array(this.fieldSize.width*this.fieldSize.height)}},methods:{getCells:function(){this.cells.fill();var t=!0,e=!1,i=void 0;try{for(var n,s=this.objects[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var a=n.value,o=a.position.y*this.fieldSize.width+a.position.x;this.cells[o]=a.icon}}catch(r){e=!0,i=r}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}return this.cells}}}),y=g,b=(i("21e5"),Object(h["a"])(y,f,m,!1,null,null,null)),v=b.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("table",{staticClass:"table-auto text-lg xl:text-2xl text-gray-600 mx-auto"},[t._m(0),i("tbody",[i("tr",[i("td",{staticClass:"border px-4 py-2"},[t._v("Elapsed Time, sec")]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t.totalElapsedTime))]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t.trainingElapsedTime))])]),i("tr",{staticClass:"bg-gray-100"},[i("td",{staticClass:"border px-4 py-2"},[t._v("Moves")]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t.totalMoves))]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t.trainingMoves))])]),i("tr",[i("td",{staticClass:"border px-4 py-2"},[t._v("Average Win Rate, %")]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t._f("formatValue")(t.totalWinRate)))]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t._f("formatValue")(t.trainingWinRate)))])]),i("tr",{staticClass:"bg-gray-100"},[i("td",{staticClass:"border px-4 py-2"},[t._v("Current Win Rate, %")]),i("td",{staticClass:"border px-4 py-2",attrs:{colspan:"2"}},[t._v(t._s(t._f("formatValue")(t.currentWinRate)))])]),i("tr",[i("td",{staticClass:"border px-4 py-2"},[t._v("Wins in a Row")]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t.totalWinsInRow))]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t.trainingWinsInRow))])]),i("tr",{staticClass:"bg-gray-100"},[i("td",{staticClass:"border px-4 py-2"},[t._v("Exploration Rate, %")]),i("td",{staticClass:"border px-4 py-2"},[t._v("0")]),i("td",{staticClass:"border px-4 py-2"},[t._v(t._s(t.explorationRate))])])])])},j=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",[i("tr",[i("th",{staticClass:"px-4 py-2 font-medium"}),i("th",{staticClass:"px-4 py-2 font-medium"},[t._v("Total")]),i("th",{staticClass:"px-4 py-2 font-medium"},[t._v("Training")])])])}],w=(i("13d5"),{name:"GameStats",props:["agent"],filters:{formatValue:function(t){return isNaN(t)?0:t}},computed:{totalElapsedTime:function(){return Math.round(this.agent.stats.totalElapsedTime/1e3)},totalMoves:function(){return this.agent.stats.totalMoves},totalWinRate:function(){var t=this.agent.stats.totalWins/this.agent.stats.totalGames;return Math.round(100*t)},currentWinRate:function(){var t=this.agent.latestGameResults.reduce((function(t,e){return t+e})),e=this.agent.latestGameResults.length>this.agent.stats.totalGames?this.agent.stats.totalGames:this.agent.latestGameResults.length;return Math.round(t/e*100)},totalWinsInRow:function(){return this.agent.stats.totalWinsInRow},trainingElapsedTime:function(){return Math.round(this.agent.stats.trainingElapsedTime/1e3)},trainingMoves:function(){return this.agent.stats.trainingMoves},trainingWinRate:function(){var t=this.agent.stats.trainingWins/this.agent.stats.trainingGames;return Math.round(100*t)},trainingWinsInRow:function(){return this.agent.stats.trainingWinsInRow},explorationRate:function(){return Math.round(100*this.agent.exploration)}}}),_=w,S=Object(h["a"])(_,x,j,!1,null,null,null),O=S.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"text-center"},[i("button",{staticClass:"bg-blue-500 hover:bg-blue-700 xl:text-2xl text-white font-bold py-2 px-4 rounded",attrs:{type:"button"},on:{click:t.toggleTraining}},[t._v(t._s(t.buttonTitle))])])},C=[],M={name:"TrainAgentButton",props:["game","agent"],data:function(){return{initialWaitTimeBetweenUpdates:this.game.waitTimeBetweenUpdates,autoStopTraining:!0}},watch:{"agent.stats.trainingMoves":function(t){this.autoStopTraining&&t>=5e3&&(this.toggleTraining(),this.autoStopTraining=!1)}},computed:{buttonTitle:function(){return this.agent.isTraining?"Stop Training...":"Train Agent"}},methods:{toggleTraining:function(){this.agent.isTraining?this.agent.disableTraining():this.agent.enableTraining(),this.game.waitTimeBetweenUpdates=this.agent.isTraining?0:this.initialWaitTimeBetweenUpdates}}},G=M,R=Object(h["a"])(G,T,C,!1,null,null,null),W=R.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"text-center"},[i("h2",{staticClass:"text-lg xl:text-2xl text-gray-600 font-medium"},[t._v("Game Speed")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.gameSpeed,expression:"gameSpeed"}],staticClass:"appearance-none w-full max-w-sm h-1 bg-gray-400 rounded outline-none slider-thumb",attrs:{type:"range",min:"0",max:t.MaxGameSpeed},domProps:{value:t.gameSpeed},on:{__r:function(e){t.gameSpeed=e.target.value}}})])},E=[],z={name:"GameSpeedSlider",props:["game"],created:function(){this.MaxGameSpeed=1e3},computed:{gameSpeed:{get:function(){return this.MaxGameSpeed-this.game.waitTimeBetweenUpdates},set:function(t){this.game.waitTimeBetweenUpdates=this.MaxGameSpeed-t}}}},I=z,A=(i("96cd"),Object(h["a"])(I,k,E,!1,null,null,null)),B=A.exports,P=i("9f12"),F=i("2fa7"),U=function t(){Object(P["a"])(this,t),Object(F["a"])(this,"icon","üê≠"),Object(F["a"])(this,"position",{x:null,y:null})},$=i("53fe"),H=function(){function t(){Object(P["a"])(this,t),Object(F["a"])(this,"icon","üßÄ"),Object(F["a"])(this,"position",{x:null,y:null})}return Object($["a"])(t,[{key:"update",value:function(){}}]),t}(),q=function(){function t(){Object(P["a"])(this,t),Object(F["a"])(this,"icon","üê±"),Object(F["a"])(this,"position",{x:null,y:null})}return Object($["a"])(t,[{key:"update",value:function(){var t=Math.random();t<.1?this.goToRandomPosition():this.goToObject(U)}},{key:"goToRandomPosition",value:function(){Math.random()>.5?this.position.x+=Math.random()>.5?1:-1:this.position.y+=Math.random()>.5?1:-1}},{key:"goToObject",value:function(t){var e=this.game.objects.find((function(e){return e instanceof t}));Math.random()>.5?this.position.x+=this.position.x>e.position.x?-1:1:this.position.y+=this.position.y>e.position.y?-1:1}}]),t}(),D=(i("c975"),i("96cf"),i("89ba")),V=i("284c"),L=i("8b83"),N=i("c65a"),J=i("9aa6"),K=i("c03e"),Q=i("0b53"),X=function(t){function e(){var t;return Object(P["a"])(this,e),t=Object(L["a"])(this,Object(N["a"])(e).call(this)),Object(F["a"])(Object(J["a"])(t),"game",null),Object(F["a"])(Object(J["a"])(t),"model",null),Object(F["a"])(Object(J["a"])(t),"exploration",1),Object(F["a"])(Object(J["a"])(t),"explorationDecay",.9995),Object(F["a"])(Object(J["a"])(t),"discount",.95),Object(F["a"])(Object(J["a"])(t),"memory",[]),Object(F["a"])(Object(J["a"])(t),"isTraining",!1),Object(F["a"])(Object(J["a"])(t),"stats",{totalElapsedTime:0,totalMoves:0,totalWins:0,totalGames:0,totalWinsInRow:0,trainingElapsedTime:0,trainingMoves:0,trainingWins:0,trainingGames:0,trainingWinsInRow:0}),Object(F["a"])(Object(J["a"])(t),"latestGameResults",Array(100).fill(0)),Object(F["a"])(Object(J["a"])(t),"latestGameIndex",0),t.buildModel(),t}return Object(K["a"])(e,t),Object($["a"])(e,[{key:"buildModel",value:function(){this.model=Q["b"]({layers:[Q["a"].dense({units:6,inputShape:16,activation:"relu"}),Q["a"].dense({units:4,activation:"linear"})]}),this.model.compile({optimizer:"sgd",loss:"meanSquaredError"})}},{key:"getState",value:function(){var t=this.game.objects.find((function(t){return t instanceof H})).position,e=this.game.objects.find((function(t){return t instanceof q})).position,i=[this.position.x>t.x,this.position.x<t.x,this.position.y>t.y,this.position.y<t.y,this.position.x>e.x&&this.position.x-e.x<=2&&this.position.y==e.y,this.position.x<e.x&&this.position.x-e.x>=-2&&this.position.y==e.y,this.position.y>e.y&&this.position.y-e.y<=2&&this.position.x==e.x,this.position.y<e.y&&this.position.y-e.y>=-2&&this.position.x==e.x,this.position.x-1==e.x&&this.position.y-1==e.y,this.position.x+1==e.x&&this.position.y-1==e.y,this.position.x-1==e.x&&this.position.y+1==e.y,this.position.x+1==e.x&&this.position.y+1==e.y,0==this.position.x,this.position.x==this.game.fieldSize.width-1,0==this.position.y,this.position.y==this.game.fieldSize.height-1];return Q["c"]([i])}},{key:"getBestAction",value:function(t){var e=this.model.predict(t).arraySync()[0],i=e.indexOf(Math.max.apply(Math,Object(V["a"])(e)));return i}},{key:"getBestActionOrRandom",value:function(){if(this.exploration>Math.random())var t=Math.floor(4*Math.random());else{var e=this.getState();t=this.getBestAction(e)}return t}},{key:"update",value:function(t){var e=this.getState();if(this.isTraining){var i=this.getBestActionOrRandom();this.memory.push({state:e,action:i}),this.exploration*=this.explorationDecay}else i=this.getBestAction(e);0==i&&this.position.x--,1==i&&this.position.x++,2==i&&this.position.y--,3==i&&this.position.y++}},{key:"lateUpdate",value:function(t){if(this.stats.totalMoves++,this.stats.totalElapsedTime+=t,this.isTraining){this.stats.trainingMoves++,this.stats.trainingElapsedTime+=t;var e=this.memory[this.memory.length-1];e.reward=e.reward||-1,e.nextState=this.getState()}this.memory.length>=100&&(this.fitModel(),this.memory=[])}},{key:"onDie",value:function(){if(this.stats.totalGames++,this.stats.totalWinsInRow=0,this.isTraining){this.stats.trainingGames++,this.stats.trainingWinsInRow=0;var t=this.memory[this.memory.length-1];t.reward=-200}this.setLatestGameResult(!1)}},{key:"onHitCheese",value:function(){if(this.stats.totalGames++,this.stats.totalWins++,this.stats.totalWinsInRow++,this.isTraining){this.stats.trainingGames++,this.stats.trainingWins++,this.stats.trainingWinsInRow++;var t=this.memory[this.memory.length-1];t.reward=100}this.setLatestGameResult(!0)}},{key:"onHitWall",value:function(){if(this.isTraining){var t=this.memory[this.memory.length-1];t.reward=-100}}},{key:"setLatestGameResult",value:function(t){this.latestGameIndex=this.latestGameIndex<this.latestGameResults.length?this.latestGameIndex:0,n["a"].set(this.latestGameResults,this.latestGameIndex++,+t)}},{key:"enableTraining",value:function(){this.isTraining=!0}},{key:"disableTraining",value:function(){this.isTraining=!1}},{key:"fitModel",value:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e,i,n,s,a,o,r,l,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(e=[],i=[],n=0;n<this.memory.length;n++)s=this.memory[n],a=s.state,o=s.action,r=s.reward,l=s.nextState,l?(c=this.model.predict(l).arraySync()[0],u=r+this.discount*Math.max.apply(Math,Object(V["a"])(c))):u=r,c=this.model.predict(a).arraySync()[0],c[o]=u,e.push(a.arraySync()[0]),i.push(c);e=Q["c"](e),i=Q["c"](i),this.model.fit(e,i,{epochs:100,batchSize:this.memory.length,shuffle:!0,callbacks:{onTrainEnd:function(t){console.log("training complete"),this.model.stopTraining=!0}.bind(this)}});case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),e}(U),Y=(i("caad"),{name:"app",components:{GameScore:p,GameField:v,GameStats:O,TrainAgentButton:W,GameSpeedSlider:B},data:function(){return{fieldSize:{width:10,height:10},objects:[],score:0,round:1,lastElapsedTime:0,waitTimeBetweenUpdates:500}},created:function(){var t=this;this.generateField(),requestAnimationFrame((function(e){t.lastElapsedTime=e,requestAnimationFrame(t.update)}))},methods:{getMouse:function(){return this.objects.find((function(t){return t instanceof U}))},update:function(t){requestAnimationFrame(this.update);var e=t-this.lastElapsedTime;if(!(e<this.waitTimeBetweenUpdates)){this.lastElapsedTime=t;var i=!0,n=!1,s=void 0;try{for(var a,o=this.objects[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var r=a.value;r.update(e),this.handleCollisions(r)}}catch(f){n=!0,s=f}finally{try{i||null==o.return||o.return()}finally{if(n)throw s}}var l=!0,c=!1,u=void 0;try{for(var h,d=this.objects[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var p=h.value;p.lateUpdate&&p.lateUpdate(e)}}catch(f){c=!0,u=f}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}}},handleCollisions:function(t){(t.position.x<0||t.position.x>=this.fieldSize.width||t.position.y<0||t.position.y>=this.fieldSize.height)&&t.onHitWall&&t.onHitWall(),t.position.x=Math.min(Math.max(t.position.x,0),this.fieldSize.width-1),t.position.y=Math.min(Math.max(t.position.y,0),this.fieldSize.height-1);var e=this.objects.find((function(t){return t instanceof U})),i=this.objects.find((function(t){return t instanceof q})),n=this.objects.find((function(t){return t instanceof H}));if(e.position.x==i.position.x&&e.position.y==i.position.y){e.onDie(),this.score--,this.round++;var s=this.objects.filter((function(t){return!(t instanceof U)})).map((function(t){return t.position}));e.position=this.generateFreePosition(s)}if(e.position.x==n.position.x&&e.position.y==n.position.y){e.onHitCheese(),this.score++,this.round++;var a=this.objects.filter((function(t){return!(t instanceof H)})).map((function(t){return t.position}));n.position=this.generateFreePosition(a)}},generateFreePosition:function(){for(var t=this,e=function(t){return Math.floor(Math.random()*t)},i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];var a=function(){var i={x:e(t.fieldSize.width),y:e(t.fieldSize.height)};if(!n.some((function(t){return t.x==i.x&&t.y==i.y})))return{v:i}};while(1){var r=a();if("object"===Object(o["a"])(r))return r.v}},generateField:function(){this.objects=[];while(this.objects.length<3){var t=this.objects.map((function(t){return t.position})),e=this.generateFreePosition(t),i=void 0;0==t.length&&(i=X),2==t.length&&(i=q),1==t.length&&(i=H),i=new i,i.position=e,i.game=this,this.objects.push(i)}}}}),Z=Y,tt=Object(h["a"])(Z,s,a,!1,null,null,null),et=tt.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(et)}}).$mount("#app")},6:function(t,e){},"96cd":function(t,e,i){"use strict";var n=i("ca5d"),s=i.n(n);s.a},"9c19":function(t,e,i){},c53c:function(t,e,i){},ca5d:function(t,e,i){},fc60:function(t,e,i){"use strict";var n=i("9c19"),s=i.n(n);s.a}});
//# sourceMappingURL=app.34bb0599.js.map